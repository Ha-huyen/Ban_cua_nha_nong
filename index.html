<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>á»¨ng dá»¥ng AI Báº¡n cá»§a nhÃ  nÃ´ng</title>
<!-- TensorFlow & Teachable Machine -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.9.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:linear-gradient(135deg,#f1f8e9,#c8e6c9);padding:14px;text-align:center}
  h1{color:#1b5e20;margin:6px 0 10px;font-size:22px}
  video,img{width:94%;max-width:420px;border-radius:12px;border:3px solid #4caf50;margin:8px auto;display:block}
  .row{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
  button{display:block;margin:8px auto;padding:12px 18px;font-size:18px;border-radius:10px;border:none;background:#43a047;color:#fff;cursor:pointer;width:90%;max-width:420px}
  button.secondary{background:#fff;color:#2e7d32;border:2px solid #4caf50}
  button.small{width:48%;padding:10px 12px}
  button:disabled{background:#ccc;color:#666;cursor:not-allowed}
  #result{margin-top:12px;font-size:18px;font-weight:700;color:#1b5e20}
  #details{display:none;background:#fff;margin:14px auto;padding:12px;border-radius:10px;max-width:420px;text-align:left;box-shadow:0 2px 8px rgba(0,0,0,0.12)}
  #details h3{color:#2e7d32;margin-bottom:8px;text-align:center}
  #details p{margin:6px 0;font-size:15px;color:#2e2e2e}
  .hint{font-size:13px;color:#4b6b4b;margin-top:6px}
</style>
</head>
<body>
  <h1>ğŸŒ¾ á»¨ng dá»¥ng AI Báº¡n cá»§a nhÃ  nÃ´ng</h1>
  <video id="webcam" autoplay playsinline muted></video>
  <img id="preview" style="display:none" alt="áº¢nh chá»¥p">

  <div class="row" style="margin-top:8px">
    <button id="startBtn" class="">ğŸ“· Báº­t camera (trÆ°á»›c)</button>
    <button id="switchBtn" class="secondary small" disabled>ğŸ”„ Äá»•i camera</button>
  </div>
  <div class="row">
    <button id="captureBtn" disabled>ğŸ–¼ï¸ Chá»¥p áº£nh</button>
    <button id="analyzeBtn" disabled>ğŸ¤– PhÃ¢n tÃ­ch áº£nh</button>
  </div>
  <div class="row">
    <button id="detailsBtn" disabled>ğŸ“– Xem chi tiáº¿t</button>
    <button id="speakBtn" disabled>ğŸ”Š Nghe láº¡i</button>
  </div>
  <div id="result">ChÆ°a cÃ³ dá»¯ liá»‡u.</div>
  <div id="details">
    <h3>ğŸ“˜ ThÃ´ng tin chi tiáº¿t</h3>
    <p><b>Biá»ƒu hiá»‡n:</b> <span id="symptoms"></span></p>
    <p><b>NguyÃªn nhÃ¢n:</b> <span id="causes"></span></p>
    <p><b>PhÃ²ng bá»‡nh:</b> <span id="prevention"></span></p>
    <p><b>ChÄƒm sÃ³c:</b> <span id="care"></span></p>
    <p><b>Äiá»u trá»‹:</b> <span id="treatment"></span></p>
  </div>
<script>
/* ---------------- CONFIG ---------------- */
const MODEL_URL = "https://teachablemachine.withgoogle.com/models/YEWRSh9R8/"; // thay náº¿u cáº§n
let model = null, stream = null, devices = [], currentDeviceId = null;
let lastClassName = null; // tÃªn hiá»ƒn thá»‹ tiáº¿ng Viá»‡t hoáº·c raw label
let selectedVoice = null;
/* ----- dá»¯ liá»‡u bá»‡nh (tá»« file báº¡n gá»­i) ----- */
const diseaseDetails = {
  "Bá»‡nh khÃ´ váº±n": {
    symptoms: "Váº¿t loang xÃ¡m tro trÃªn báº¹ lÃ¡ vÃ  thÃ¢n, dáº¡ng Ä‘Ã¡m mÃ¢y; váº¿t bá»‡nh lan tá»« gá»‘c lÃªn báº¯p lÃ m lÃ¡ vÃ ng khÃ´ vÃ  cÃ¢y bá»‹ cháº¿t; khi áº©m, trÃªn váº¿t bá»‡nh cÃ³ lá»›p sá»£i náº¥m mÃ u tráº¯ng.",
    causes: "Do náº¥m Rhizoctonia solani Kuhn. Náº¥m tá»“n táº¡i trÃªn tÃ n dÆ° cÃ¢y bá»‡nh vÃ  trong Ä‘áº¥t (háº¡ch náº¥m). PhÃ¡t triá»ƒn máº¡nh khi áº©m Æ°á»›t, nhiá»‡t Ä‘á»™ 25â€“30Â°C; cÅ©ng liÃªn quan Ä‘áº¿n bÃ³n Ä‘áº¡m quÃ¡ nhiá»u vÃ  máº­t Ä‘á»™ trá»“ng dÃ y.",
    prevention: "Chá»n giá»‘ng Ã­t nhiá»…m, gieo Ä‘Ãºng thá»i vá»¥, máº­t Ä‘á»™ phÃ¹ há»£p; vá»‡ sinh Ä‘á»“ng ruá»™ng, tiÃªu há»§y tÃ n dÆ° cÃ¢y bá»‡nh; xá»­ lÃ½ háº¡t giá»‘ng trÆ°á»›c khi gieo.",
    care: "Giá»¯ ruá»™ng thÃ´ng thoÃ¡ng, khÃ´ng bÃ³n thá»«a Ä‘áº¡m, xá»­ lÃ½ háº¡t, sá»­ dá»¥ng cháº¿ pháº©m Trichoderma Ä‘á»ƒ á»©c cháº¿ náº¥m.",
    treatment: "Phun thuá»‘c khuyáº¿n cÃ¡o nhÆ° Anvil 5SC, Azotide, Tilt Super 300EC, hoáº·c Evitin 50SC theo hÆ°á»›ng dáº«n."
  },
  "Bá»‡nh Ä‘á»‘m lÃ¡ lá»›n": {
    symptoms: "Xuáº¥t hiá»‡n Ä‘á»‘m báº§u dá»¥c/hÃ¬nh thoi trÃªn lÃ¡, tá»« nÃ¢u nháº¡t Ä‘áº¿n nÃ¢u Ä‘áº­m; Ä‘á»‘m cÃ³ thá»ƒ dÃ i 10â€“15 cm, giá»¯a Ä‘á»‘m xÃ¡m tro; náº·ng lÃ m lÃ¡ khÃ´ chÃ¡y.",
    causes: "Do náº¥m Exserohilum turcicum; phÃ¡t triá»ƒn máº¡nh khi thá»i tiáº¿t nÃ³ng áº©m, mÆ°a nhiá»u; lÃ¢y lan qua giÃ³ vÃ  nÆ°á»›c mÆ°a.",
    prevention: "Chá»n giá»‘ng khÃ¡ng, luÃ¢n canh, dá»n tÃ n dÆ° cÃ¢y bá»‡nh, bÃ³n phÃ¢n cÃ¢n Ä‘á»‘i.",
    care: "Giáº£m Ä‘áº¡m, tÄƒng kali, sá»­ dá»¥ng cháº¿ pháº©m sinh há»c Ä‘á»ƒ tÄƒng sá»©c Ä‘á» khÃ¡ng.",
    treatment: "Phun thuá»‘c Ä‘áº·c trá»‹ nhÆ° Daconil, Score hoáº·c Tilt theo hÆ°á»›ng dáº«n."
  },
  "Bá»‡nh pháº¥n Ä‘en": {
    symptoms: "Xuáº¥t hiá»‡n cÃ¡c ná»‘t u sÆ°ng tráº¯ng trÃªn báº¹ lÃ¡, thÃ¢n, báº¯p; u phÃ¬nh to rá»“i bÃªn trong cÃ³ bá»™t Ä‘en (bÃ o tá»­). Khi bÃ³p váº¿t bá»‡nh bá»™t Ä‘en vá»¡ ra, lÃ m dá»‹ dáº¡ng vÃ  thá»‘i bá»™ pháº­n nhiá»…m.",
    causes: "Do náº¥m Ustilago maydis hoáº·c Ustilago zeae; náº¥m tá»“n táº¡i trÃªn háº¡t giá»‘ng, tÃ n dÆ° cÃ¢y bá»‡nh; phÃ¡t tÃ¡n qua giÃ³/nÆ°á»›c/váº¿t thÆ°Æ¡ng cÆ¡ giá»›i.",
    prevention: "LuÃ¢n canh, xá»­ lÃ½ háº¡t giá»‘ng, dá»n tÃ n dÆ° cÃ¢y bá»‡nh, bÃ³n phÃ¢n cÃ¢n Ä‘á»‘i, háº¡n cháº¿ Ä‘áº¡m.",
    care: "Cáº¯t bá» vÃ  tiÃªu há»§y pháº§n bá»‹ bá»‡nh, bÃ³n kali vÃ  há»¯u cÆ¡ Ä‘á»ƒ tÄƒng sá»©c khá»e cÃ¢y.",
    treatment: "Phun cháº¿ pháº©m sinh há»c (Antafungal) hoáº·c thuá»‘c chá»©a tebuconazole, propiconazole, hexaconazole; káº¿t há»£p Trichoderma."
  },
  "CÃ¢y ngÃ´ khá»e": {
    symptoms: "LÃ¡ xanh bÃ³ng, khÃ´ng cÃ³ Ä‘á»‘m bá»‡nh hay pháº¥n phá»§.",
    causes: "Äiá»u kiá»‡n sinh trÆ°á»Ÿng tá»‘t, dinh dÆ°á»¡ng vÃ  Ä‘á»™ áº©m cÃ¢n Ä‘á»‘i.",
    prevention: "Duy trÃ¬ tÆ°á»›i bÃ³n há»£p lÃ½, phÃ²ng bá»‡nh Ä‘á»‹nh ká»³.",
    care: "Giá»¯ ruá»™ng thÃ´ng thoÃ¡ng, bÃ³n phÃ¢n cÃ¢n Ä‘á»‘i.",
    treatment: "KhÃ´ng cáº§n xá»­ lÃ½ thÃªm."
  }
};
/* ----- tÃªn nhÃ£n/label -> tÃªn hiá»ƒn thá»‹ tiáº¿ng Viá»‡t ----- */
/* Ä‘iá»u nÃ y giÃºp náº¿u mÃ´ hÃ¬nh tráº£ BENH_PHAN_DEN -> hiá»ƒn thá»‹ "Bá»‡nh pháº¥n Ä‘en" */
const nameMap = {
  "BENH_KHO_VAN": "Bá»‡nh khÃ´ váº±n",
  "BENH_DOM_LA_LON": "Bá»‡nh Ä‘á»‘m lÃ¡ lá»›n",
  "BENH_PHAN_DEN": "Bá»‡nh pháº¥n Ä‘en",
  "CAY_NGO_KHOE": "CÃ¢y ngÃ´ khá»e"
};
/* -------- elements -------- */
const videoEl = document.getElementById('webcam');
const previewEl = document.getElementById('preview');
const startBtn = document.getElementById('startBtn');
const switchBtn = document.getElementById('switchBtn');
const captureBtn = document.getElementById('captureBtn');
const analyzeBtn = document.getElementById('analyzeBtn');
const detailsBtn = document.getElementById('detailsBtn');
const speakBtn = document.getElementById('speakBtn');
const resultDiv = document.getElementById('result');
const detailsDiv = document.getElementById('details');
const symptomsEl = document.getElementById('symptoms');
const causesEl = document.getElementById('causes');
const preventionEl = document.getElementById('prevention');
const careEl = document.getElementById('care');
const treatmentEl = document.getElementById('treatment');
/* -------- TTS voice selection (try to choose Vietnamese female) -------- */
function chooseVoice() {
  const voices = speechSynthesis.getVoices();
  if (!voices || voices.length === 0) return null;
  // prefer exact vi-VN voices
  let candidate = voices.find(v => v.lang && v.lang.toLowerCase().startsWith('vi'));
  if (!candidate) {
    // try names that suggest female or vietnam
    candidate = voices.find(v => /female|woman|vi|vietnam|google/i.test(v.name));
  }
  return candidate || voices[0];
}
function speak(text) {
  if (!('speechSynthesis' in window)) return;
  // choose voice if not set
  if (!selectedVoice) {
    selectedVoice = chooseVoice();
  }
  // Try to speak; note many mobile browsers require user gesture first.
  try {
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'vi-VN';
    u.rate = 0.95;
    u.pitch = 1.05;
    if (selectedVoice) u.voice = selectedVoice;
    window.speechSynthesis.speak(u);
  } catch (e) {
    console.warn('TTS error', e);
  }
}
/* -------- normalize / fuzzy match labels -------- */
function normalizeLabel(s) {
  if (!s) return '';
  return s.normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^A-Za-z0-9\s_-]/g,'').trim().toUpperCase().replace(/\s+/g,'_');
}
function findClosestName(label) {
  if (!label) return null;
  const n = normalizeLabel(label);
  // try nameMap keys
  for (const k in nameMap) {
    if (n === k || n.includes(k) || k.includes(n)) return nameMap[k];
  }
  // try diseaseDetails keys
  for (const k in diseaseDetails) {
    const nk = normalizeLabel(k);
    if (nk === n || nk.includes(n) || n.includes(nk)) return k;
  }
  return null;
}
/* -------- load model -------- */
async function loadModel() {
  resultDiv.innerText = 'â³ Äang táº£i mÃ´ hÃ¬nh...';
  await tf.ready();
  try {
    model = await tmImage.load(MODEL_URL + 'model.json', MODEL_URL + 'metadata.json');
    resultDiv.innerText = 'âœ… MÃ´ hÃ¬nh sáºµn sÃ ng. Nháº¥n "Báº­t camera".';
    // preload voices list (some browsers populate on user gesture only)
    speechSynthesis.getVoices();
  } catch (e) {
    console.error('Load model failed', e);
    resultDiv.innerText = 'âŒ Lá»—i táº£i mÃ´ hÃ¬nh';
  }
}
loadModel();
/* -------- enumerate devices -------- */
async function enumerateDevices() {
  try {
    const all = await navigator.mediaDevices.enumerateDevices();
    devices = all.filter(d => d.kind === 'videoinput');
    switchBtn.disabled = devices.length < 2;
  } catch (e) {
    devices = [];
    switchBtn.disabled = true;
  }
}
/* -------- start camera (default front) -------- */
async function startCamera(preferFront = true) {
  try {
    await enumerateDevices();
    let constraints;
    if (devices.length > 0) {
      // try to find front camera by label
      const front = devices.find(d => /front|user/i.test(d.label)) || devices.find(d => /front|user/i.test(d.deviceId));
      if (preferFront && front) {
        currentDeviceId = front.deviceId;
        constraints = { video: { deviceId: { exact: currentDeviceId } } };
      } else {
        // fallback to facingMode user (front)
        constraints = { video: { facingMode: { exact: 'user' } } };
      }
    } else {
      constraints = { video: { facingMode: { exact: 'user' } } };
    }
    if (stream) stream.getTracks().forEach(t => t.stop());
    stream = await navigator.mediaDevices.getUserMedia(constraints);
    videoEl.srcObject = stream;
    // wait until video has size
    await new Promise(res => {
      const check = () => { if (videoEl.videoWidth && videoEl.videoHeight) res(); else requestAnimationFrame(check); };
      check();
    });
    captureBtn.disabled = false;
    analyzeBtn.disabled = true;
    detailsBtn.disabled = true;
    speakBtn.disabled = true;
    startBtn.disabled = true;
    resultDiv.innerText = 'ğŸ“¸ Camera Ä‘Ã£ báº­t (trÆ°á»›c). HÆ°á»›ng váº­t thá»ƒ vÃ  chá»¥p áº£nh.';
    speak('Camera Ä‘Ã£ báº­t. HÃ£y chá»¥p áº£nh lÃ¡ Ä‘á»ƒ phÃ¢n tÃ­ch.');
    // update device list after labels become available
    await enumerateDevices();
  } catch (e) {
    console.error('startCamera error', e);
    alert('âš ï¸ KhÃ´ng thá»ƒ báº­t camera. HÃ£y má»Ÿ trang báº±ng Chrome vÃ  cáº¥p quyá»n camera.');
    resultDiv.innerText = 'âŒ KhÃ´ng thá»ƒ báº­t camera';
  }
}
/* -------- switch camera (cycle) -------- */
async function switchCamera() {
  if (devices.length < 2) return;
  const idx = devices.findIndex(d => d.deviceId === currentDeviceId);
  const next = devices[(idx + 1) % devices.length] || devices[0];
  currentDeviceId = next.deviceId;
  // if switching, try to start with that deviceId
  try {
    if (stream) stream.getTracks().forEach(t => t.stop());
    const constraints = { video: { deviceId: { exact: currentDeviceId } } };
    stream = await navigator.mediaDevices.getUserMedia(constraints);
    videoEl.srcObject = stream;
    // wait for width/height
    await new Promise(res => {
      const check = () => { if (videoEl.videoWidth && videoEl.videoHeight) res(); else requestAnimationFrame(check); };
      check();
    });
  } catch (e) {
    console.warn('switchCamera failed, restarting camera normally', e);
    await startCamera(false);
  }
}
/* -------- capture image -------- */
async function captureImage() {
  if (!stream) { alert('ChÆ°a báº­t camera.'); return; }
  if (!videoEl.videoWidth || !videoEl.videoHeight) {
    await new Promise(res => {
      const check = () => { if (videoEl.videoWidth && videoEl.videoHeight) res(); else requestAnimationFrame(check); };
      check();
    });
  }
  const canvas = document.createElement('canvas');
  canvas.width = videoEl.videoWidth;
  canvas.height = videoEl.videoHeight;
  canvas.getContext('2d').drawImage(videoEl, 0, 0, canvas.width, canvas.height);
  previewEl.src = canvas.toDataURL('image/jpeg', 0.9);
  previewEl.style.display = 'block';
  analyzeBtn.disabled = false;
  detailsBtn.disabled = true;
  speakBtn.disabled = true;
  resultDiv.innerText = 'ğŸ–¼ï¸ áº¢nh Ä‘Ã£ chá»¥p. Nháº¥n PhÃ¢n tÃ­ch.';
  // try to select voice at this user gesture moment
  selectedVoice = chooseVoiceOnDemand();
}
/* helper to get voices at user gesture */
function chooseVoiceOnDemand() {
  const vs = speechSynthesis.getVoices();
  if (!vs || vs.length === 0) return null;
  // pick vi-VN voice; prefer female-like naming
  let v = vs.find(x => x.lang && x.lang.toLowerCase().startsWith('vi'));
  if (!v) v = vs.find(x => /female|woman|vi|vietnam|google/i.test(x.name));
  return v || vs[0];
}
/* -------- analyze image with model -------- */
async function analyzeImage() {
  if (!model) { alert('MÃ´ hÃ¬nh chÆ°a sáºµn sÃ ng.'); return; }
  if (!previewEl.src) { alert('Báº¡n cáº§n chá»¥p áº£nh trÆ°á»›c.'); return; }
  resultDiv.innerText = 'ğŸ” Äang phÃ¢n tÃ­ch...';
  try {
    await new Promise(res => previewEl.complete ? res() : previewEl.onload = res);
    const preds = await model.predict(previewEl);
    if (!Array.isArray(preds) || preds.length === 0) throw new Error('No predictions');
    preds.sort((a,b) => b.probability - a.probability);
    const top = preds[0];
    const raw = String(top.className || '');
    const found = findClosestName(raw);
    const name = found || raw.trim() || 'KhÃ´ng xÃ¡c Ä‘á»‹nh';
    const conf = (top.probability * 100).toFixed(1);
    resultDiv.innerText = `Káº¿t luáº­n: ${name} (${conf}%)`;
    // read short result with female voice if available
    const voiceName = selectedVoice ? selectedVoice.name : (speechSynthesis.getVoices()[0] || {}).name;
    speak(`Káº¿t luáº­n: ${name}. Äá»™ tin cáº­y ${conf} pháº§n trÄƒm.`);
    lastClassName = name;
    // populate details (but keep details hidden until user presses xem)
    const ok = populateDetails(name);
    detailsBtn.disabled = !ok;
    speakBtn.disabled = !ok;
  } catch (e) {
    console.error('analyzeImage error', e);
    resultDiv.innerText = 'âŒ Lá»—i khi phÃ¢n tÃ­ch';
    speak('Lá»—i khi phÃ¢n tÃ­ch áº£nh. Vui lÃ²ng thá»­ láº¡i.');
  }
}

/* -------- populate details for a name -------- */
function populateDetails(name) {
  let info = diseaseDetails[name];
  if (!info) {
    const fb = findClosestName(name);
    if (fb) info = diseaseDetails[fb];
  }
  if (!info) {
    // clear fields
    symptomsEl.textContent = '';
    causesEl.textContent = '';
    preventionEl.textContent = '';
    careEl.textContent = '';
    treatmentEl.textContent = '';
    return false;
  }
  symptomsEl.textContent = info.symptoms;
  causesEl.textContent = info.causes;
  preventionEl.textContent = info.prevention;
  careEl.textContent = info.care;
  treatmentEl.textContent = info.treatment;
  return true;
}

/* -------- details button toggle & speak full details -------- */
detailsBtn.addEventListener('click', () => {
  if (!lastClassName) { alert('Báº¡n chÆ°a phÃ¢n tÃ­ch áº£nh.'); return; }
  const ok = populateDetails(lastClassName);
  if (!ok) { alert('ChÆ°a cÃ³ thÃ´ng tin chi tiáº¿t cho káº¿t quáº£ nÃ y.'); return; }
  detailsDiv.style.display = detailsDiv.style.display === 'block' ? 'none' : 'block';
  if (detailsDiv.style.display === 'block') {
    const info = diseaseDetails[lastClassName] || diseaseDetails[findClosestName(lastClassName)];
    if (info) {
      // speak full details in a friendly female tone where possible
      const text = `Biá»ƒu hiá»‡n: ${info.symptoms}. NguyÃªn nhÃ¢n: ${info.causes}. CÃ¡ch phÃ²ng bá»‡nh: ${info.prevention}. ChÄƒm sÃ³c: ${info.care}. Äiá»u trá»‹: ${info.treatment}.`;
      speak(text);
    }
  }
});

/* -------- speak button to replay details -------- */
speakBtn.addEventListener('click', () => {
  if (!lastClassName) { alert('ChÆ°a cÃ³ káº¿t quáº£ phÃ¢n tÃ­ch.'); return; }
  const info = diseaseDetails[lastClassName] || diseaseDetails[findClosestName(lastClassName)];
  if (!info) { alert('KhÃ´ng cÃ³ thÃ´ng tin chi tiáº¿t cho káº¿t quáº£ nÃ y.'); return; }
  const text = `Biá»ƒu hiá»‡n: ${info.symptoms}. NguyÃªn nhÃ¢n: ${info.causes}. CÃ¡ch phÃ²ng bá»‡nh: ${info.prevention}. ChÄƒm sÃ³c: ${info.care}. Äiá»u trá»‹: ${info.treatment}.`;
  speak(text);
});

/* -------- utility: normalize & fuzzy match (robust) -------- */
function normalizeForMatch(s) {
  if (!s) return '';
  return s.normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^A-Za-z0-9\s_-]/g,'').trim().toUpperCase().replace(/\s+/g,'_');
}
function findClosestName(label) {
  if (!label) return null;
  const n = normalizeForMatch(label);
  // try direct mapping via nameMap keys normalized
  for (const k in nameMap) {
    if (n === k || n.includes(k) || k.includes(n)) return nameMap[k];
  }
  // try matching diseaseDetails keys
  for (const k in diseaseDetails) {
    const nk = normalizeForMatch(k);
    if (nk === n || nk.includes(n) || n.includes(nk)) return k;
  }
  // fallback: try partial token match
  const tokens = n.split('_').filter(Boolean);
  for (const k in diseaseDetails) {
    const nk = normalizeForMatch(k);
    let matches = tokens.filter(t => nk.includes(t));
    if (matches.length >= 1) return k;
  }
  return null;
}
/* -------- button wiring -------- */
startBtn.addEventListener('click', () => startCamera(true));
switchBtn.addEventListener('click', () => switchCamera());
captureBtn.addEventListener('click', () => captureImage());
analyzeBtn.addEventListener('click', () => analyzeImage());
/* -------- init UI state & enumerate -------- */
(function init(){
  captureBtn.disabled = true;
  analyzeBtn.disabled = true;
  detailsBtn.disabled = true;
  speakBtn.disabled = true;
  switchBtn.disabled = true;
  // preload devices list
  enumerateDevices();
  // preload voices (some browsers require user gesture)
  speechSynthesis.getVoices();
})();
</script>
</body>
</html>
